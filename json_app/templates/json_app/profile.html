{% extends "json_app/base.html" %}

{% block body %}
<h2>User Profile</h2>

<div id="profile-content">
    <p>Cargando perfil...</p>
</div>

<script>
// Fetch user profile data from the server
document.addEventListener('DOMContentLoaded', () => {
    // Ensure the profile content is empty before fetching
    const profileContainer = document.getElementById('profile-content');
    // Clear previous content
    fetch('{% url "profile_json" %}?format=json', {
        headers: {
            'Accept': 'application/json'
        }
    })
    // Fetch the profile data
    .then(res => res.ok ? res.json() : Promise.reject(res))
    // Render the profile data
    .then(data => {
        profileContainer.innerHTML = renderProfile(data);
    })
    // Handle errors
    .catch(error => {
        profileContainer.innerHTML = '<p>Error retrieving profile data.</p>';
    });
    // Function to render the profile data
    function renderProfile(data) {
        const { username, email, role, user_id, permissions, groups, is_admin } = data;

        let html = `
            <table>
                <tr><td><strong>Username:</strong></td><td>${username}</td></tr>
                <tr><td><strong>Email:</strong></td><td>${email || '-'}</td></tr>
                <tr><td><strong>Role:</strong></td><td>${role}</td></tr>
                <tr><td><strong>User ID:</strong></td><td>${user_id}</td></tr>
            </table>
        `;

        if (permissions?.length) {
            html += `
                <h3>Permissions:</h3>
                <ul>${permissions.map(p => `<li>${p}</li>`).join('')}</ul>
            `;
        }

        if (groups?.length) {
            html += `
                <h3>Groups:</h3>
                <ul>${groups.map(g => `<li>${g}</li>`).join('')}</ul>
            `;
        }

        return html;
    }
});
</script>
{% endblock %}
